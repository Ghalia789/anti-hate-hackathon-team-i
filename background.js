const i="https://hate-speech-api-486614.uc.r.appspot.com/api";chrome.runtime.onInstalled.addListener(()=>{console.log("ðŸ’œ HateLess Extension installed"),chrome.storage.sync.set({isActive:!0,apiUrl:i,stats:{analyzed:0,blocked:0}})});chrome.runtime.onMessage.addListener((e,s,t)=>{var o,c;if(e.action==="analyzeText")return d(e.text).then(a=>{chrome.storage.sync.get(["stats"],l=>{var r;const n=l.stats||{analyzed:0,blocked:0};n.analyzed++,(r=a.toxicity)!=null&&r.is_toxic&&n.blocked++,chrome.storage.sync.set({stats:n})}),t({success:!0,result:a})}).catch(a=>{console.error("Analysis error:",a),t({success:!1,error:a.message})}),!0;if(e.action==="openPopup"&&((c=(o=chrome.action).openPopup)==null||c.call(o)),e.action==="getStats")return chrome.storage.sync.get(["stats"],a=>{t({stats:a.stats||{analyzed:0,blocked:0}})}),!0});async function d(e){const{apiUrl:s}=await chrome.storage.sync.get(["apiUrl"]),o=await fetch(`${s||i}/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!o.ok)throw new Error("Failed to analyze text");return await o.json()}chrome.storage.onChanged.addListener((e,s)=>{if(s==="sync"&&e.isActive){const t=e.isActive.newValue;chrome.action.setBadgeText({text:t?"ON":""}),chrome.action.setBadgeBackgroundColor({color:t?"#10b981":"#ef4444"})}});
